<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= post.Title %> - ðŸŽ® Gaming Blog</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Hero Header -->
    <header class="hero-header">
        <div class="container">
            <!-- Breadcrumb Navigation -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb breadcrumb-nav">
                    <li class="breadcrumb-item">
                        <a href="/blog"><i class="fas fa-home me-2"></i>Blog</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        <i class="fas fa-file-alt me-2"></i><%= post.Title %>
                    </li>
                </ol>
            </nav>
            
            <!-- Hero Content -->
            <div class="text-center">
                <h1 class="hero-title" data-aos="fade-down" data-aos-duration="1000">
                    <%= post.Title %>
                </h1>
                <div class="hero-meta" data-aos="fade-up" data-aos-duration="1000" data-aos-delay="200">
                    <i class="fas fa-calendar-alt me-2"></i>
                    <%= new Date(post.CreatedAt).toLocaleDateString('es-ES', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) %>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="row">
                <!-- Main Content Column -->
                <div class="col-lg-8">
                    <!-- Post Content Section -->
                    <article class="post-content-section" data-aos="fade-up" data-aos-duration="800">
                        <!-- Post Meta Grid -->
                        <div class="post-meta-grid" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
                            <div class="meta-item">
                                <div class="meta-icon">
                                    <i class="fas fa-hashtag"></i>
                                </div>
                                <div class="meta-label">Post ID</div>
                                <div class="meta-value"><%= post.PostID %></div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="meta-label">Usuario</div>
                                <div class="meta-value"><%= post.UserID %></div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="meta-label">Creado</div>
                                <div class="meta-value"><%= new Date(post.CreatedAt).toLocaleDateString('es-ES') %></div>
                            </div>
                        </div>
                        
                        <!-- Post Content -->
                        <div class="post-text" data-aos="fade-up" data-aos-duration="800" data-aos-delay="400">
                            <%= post.Content %>
                        </div>
                    </article>

                    <!-- Comments Section -->
                    <section class="comments-section" data-aos="fade-up" data-aos-duration="800" data-aos-delay="600">
                        <h2 class="section-title">
                            <i class="fas fa-comments"></i>Comentarios
                        </h2>
                        
                        <!-- Comment Form -->
                        <form class="comment-form" id="commentForm">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label for="commentContent" class="form-label">
                                            <i class="fas fa-edit me-2"></i>Tu comentario
                                        </label>
                                        <textarea class="form-control" id="commentContent" rows="4" required 
                                                  placeholder="Comparte tu opiniÃ³n sobre este post..."></textarea>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="userID" class="form-label">
                                            <i class="fas fa-user me-2"></i>Tu ID
                                        </label>
                                        <input type="number" class="form-control" id="userID" value="1" required>
                                    </div>
                                    <button type="submit" class="btn btn-submit w-100" id="submitCommentBtn">
                                        <span class="btn-text">
                                            <i class="fas fa-paper-plane me-2"></i>Enviar
                                        </span>
                                        <span class="btn-loading d-none">
                                            <span class="loading-spinner me-2"></span>Enviando...
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </form>
                        
                        <!-- Comments List -->
                        <div id="commentsContainer">
                            <div class="empty-comments" id="emptyComments">
                                <i class="fas fa-comment-slash"></i>
                                <h4>No hay comentarios aÃºn</h4>
                                <p>Â¡SÃ© el primero en comentar!</p>
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- Sidebar -->
                <div class="col-lg-4">
                    <div class="sidebar">
                        <!-- About Post Card -->
                        <div class="sidebar-card" data-aos="slide-in-left" data-aos-duration="800" data-aos-delay="400">
                            <h3 class="sidebar-title">
                                <i class="fas fa-info-circle"></i>Acerca del Post
                            </h3>
                            <p class="text-muted">
                                Este es un post del Gaming Blog donde puedes encontrar informaciÃ³n detallada, 
                                comentarios de la comunidad y participar en la discusiÃ³n.
                            </p>
                        </div>
                        
                        <!-- Actions Card -->
                        <div class="sidebar-card" data-aos="slide-in-left" data-aos-duration="800" data-aos-delay="600">
                            <h3 class="sidebar-title">
                                <i class="fas fa-tools"></i>Acciones
                            </h3>
                            <ul class="action-list">
                                <li class="action-item">
                                    <a href="/blog" class="action-link">
                                        <i class="fas fa-arrow-left action-icon"></i>
                                        Volver al Blog
                                    </a>
                                </li>
                                <li class="action-item">
                                    <a href="#" class="action-link" onclick="editPost()">
                                        <i class="fas fa-edit action-icon"></i>
                                        Editar Post
                                    </a>
                                </li>
                                <li class="action-item">
                                    <a href="#" class="action-link text-danger" onclick="deletePost()">
                                        <i class="fas fa-trash action-icon"></i>
                                        Eliminar Post
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Share Card -->
                        <div class="sidebar-card" data-aos="slide-in-left" data-aos-duration="800" data-aos-delay="800">
                            <h3 class="sidebar-title">
                                <i class="fas fa-share-alt"></i>Compartir
                            </h3>
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary" onclick="sharePost()">
                                    <i class="fab fa-facebook me-2"></i>Facebook
                                </button>
                                <button class="btn btn-outline-info" onclick="sharePost()">
                                    <i class="fab fa-twitter me-2"></i>Twitter
                                </button>
                                <button class="btn btn-outline-success" onclick="sharePost()">
                                    <i class="fab fa-whatsapp me-2"></i>WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="/js/main.js"></script>
    
    <script>
        // Initialize AOS animations
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true,
            offset: 100
        });

        // Post data from EJS
        const postData = {
            id: <%= post.PostID %>,
            title: '<%= post.Title.replace(/'/g, "\\'") %>',
            content: '<%= post.Content.replace(/'/g, "\\'") %>'
        };

        // DOM elements
        const commentsContainer = document.getElementById('commentsContainer');
        const commentForm = document.getElementById('commentForm');
        const submitCommentBtn = document.getElementById('submitCommentBtn');
        const emptyComments = document.getElementById('emptyComments');

        // Load comments on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadComments();
        });

        // Load comments function
        async function loadComments() {
            try {
                const response = await fetch(`/blog/${postData.id}/comments`);
                if (!response.ok) throw new Error('Error al obtener comentarios');
                
                const comments = await response.json();
                displayComments(comments);
            } catch (error) {
                console.error('Error loading comments:', error);
                showError('No se pudieron cargar los comentarios');
            }
        }

        // Display comments function
        function displayComments(comments) {
            if (!comments || comments.length === 0) {
                emptyComments.style.display = 'block';
                return;
            }

            emptyComments.style.display = 'none';
            commentsContainer.innerHTML = '';

            comments.forEach((comment, index) => {
                const commentElement = createCommentElement(comment, index);
                commentsContainer.appendChild(commentElement);
            });
        }

        // Create comment element
        function createCommentElement(comment, index) {
            const div = document.createElement('div');
            div.className = 'comment-card';
            div.style.animationDelay = `${index * 100}ms`;
            div.classList.add('fade-in');
            
            const createdAt = comment.CreatedAt ? 
                new Date(comment.CreatedAt).toLocaleString('es-ES') : 'Fecha desconocida';

            div.innerHTML = `
                <div class="comment-content">${comment.Content}</div>
                <div class="comment-meta">
                    <span><i class="fas fa-user me-1"></i>Usuario ${comment.UserID}</span>
                    <span><i class="fas fa-clock me-1"></i>${createdAt}</span>
                </div>
                <div class="comment-actions">
                    <button class="btn-action btn-edit" onclick="editComment(${comment.CommentID})" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-action btn-delete" onclick="deleteComment(${comment.CommentID})" title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            return div;
        }

        // Submit comment form
        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = submitCommentBtn;
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoading = submitBtn.querySelector('.btn-loading');
            
            // Show loading state
            btnText.classList.add('d-none');
            btnLoading.classList.remove('d-none');
            submitBtn.disabled = true;
            
            const content = document.getElementById('commentContent').value.trim();
            const userID = parseInt(document.getElementById('userID').value, 10) || 1;
            
            if (!content) {
                alert('Escribe un comentario antes de enviar');
                resetCommentForm();
                return;
            }
            
            try {
                const response = await fetch(`/blog/${postData.id}/comments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content, userID })
                });
                
                if (!response.ok) throw new Error('Error al enviar comentario');
                
                // Success animation
                submitBtn.innerHTML = '<i class="fas fa-check me-2"></i>Â¡Enviado!';
                submitBtn.style.background = 'var(--gradient-success)';
                
                // Reset form and reload comments
                document.getElementById('commentContent').value = '';
                setTimeout(() => {
                    loadComments();
                    resetCommentForm();
                }, 1500);
                
            } catch (error) {
                console.error('Error sending comment:', error);
                alert('No se pudo enviar el comentario: ' + error.message);
                resetCommentForm();
            }
        });

        function resetCommentForm() {
            const submitBtn = submitCommentBtn;
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoading = submitBtn.querySelector('.btn-loading');
            
            btnText.classList.remove('d-none');
            btnLoading.classList.add('d-none');
            submitBtn.disabled = false;
            submitBtn.innerHTML = btnText.outerHTML;
            submitBtn.style.background = '';
        }

        // Edit comment function
        async function editComment(commentID) {
            if (!commentID) return;
            
            const newContent = prompt('Editar comentario:');
            if (newContent === null) return; // User cancelled
            
            const content = newContent.trim();
            if (!content) return alert('El contenido no puede quedar vacÃ­o');
            
            try {
                const response = await fetch(`/blog/comments/${commentID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content })
                });
                
                if (!response.ok) throw new Error('Error al editar comentario');
                
                showSuccess('Comentario editado exitosamente');
                loadComments();
            } catch (error) {
                console.error('Error editing comment:', error);
                alert('No se pudo editar el comentario: ' + error.message);
            }
        }

        // Delete comment function
        async function deleteComment(commentID) {
            if (!commentID) return;
            if (!confirm('Â¿EstÃ¡s seguro de que quieres eliminar este comentario?')) return;
            
            try {
                const response = await fetch(`/blog/comments/${commentID}`, { 
                    method: 'DELETE' 
                });
                
                if (!response.ok) throw new Error('Error al eliminar comentario');
                
                showSuccess('Comentario eliminado exitosamente');
                loadComments();
            } catch (error) {
                console.error('Error deleting comment:', error);
                alert('No se pudo eliminar el comentario: ' + error.message);
            }
        }

        // Edit post function
        function editPost() {
            const newTitle = prompt('Nuevo tÃ­tulo:', postData.title);
            const newContent = prompt('Nuevo contenido:', postData.content);
            
            if (newTitle && newContent) {
                fetch(`/blog/${postData.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: newTitle, content: newContent })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        showSuccess('Post actualizado exitosamente');
                        setTimeout(() => location.reload(), 1500);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al actualizar post: ' + error.message);
                });
            }
        }

        // Delete post function
        function deletePost() {
            if (confirm('Â¿EstÃ¡s seguro de que quieres eliminar este post? Esta acciÃ³n no se puede deshacer.')) {
                fetch(`/blog/${postData.id}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        showSuccess('Post eliminado exitosamente');
                        setTimeout(() => {
                            window.location.href = '/blog';
                        }, 1500);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al eliminar post: ' + error.message);
                });
            }
        }

        // Share post function
        function sharePost() {
            const url = window.location.href;
            const text = `Â¡Mira este post en Gaming Blog: ${postData.title}`;
            
            if (navigator.share) {
                navigator.share({
                    title: postData.title,
                    text: text,
                    url: url
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
                window.open(shareUrl, '_blank');
            }
        }

        // Utility functions
        function showSuccess(message) {
            // You can implement a toast notification here
            console.log('Success:', message);
        }

        function showError(message) {
            // You can implement a toast notification here
            console.error('Error:', message);
        }

        // Add some interactive effects
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects to action links
            const actionLinks = document.querySelectorAll('.action-link');
            actionLinks.forEach(link => {
                link.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(10px) scale(1.05)';
                });
                
                link.addEventListener('mouseleave', function() {
                    this.style.transform = '';
                });
            });
            
            // Add click effect to meta items
            const metaItems = document.querySelectorAll('.meta-item');
            metaItems.forEach(item => {
                item.addEventListener('click', function() {
                    this.style.animation = 'bounce-in 0.6s ease-in-out';
                    setTimeout(() => {
                        this.style.animation = '';
                    }, 600);
                });
            });
        });
    </script>
</body>
</html>
